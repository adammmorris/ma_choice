<!doctype HTML> 
<html> 
<head>
	<title>Multi Attribute Research Study</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	<script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-html-slider-response.js"></script>
    <script src='jspsych/plugins/jspsych-instructions.js'></script>
    <script src='jspsych/plugins/jspsych-survey-text.js'></script>
    <script src='jspsych/plugins/jspsych-external-html.js'></script>
    <script src='jspsych/plugins/jspsych-html-button-response.js'></script>
    <script src='jspsych/plugins/jspsych-image-button-response.js'></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    <script src="utilities.js"></script>
    <style>
	td, th {padding: 20px;}
	.big {font-size: 40px;}
	.med {font-size: 24px;}
	</style>
</head>
<body>
</body>
<script>

// ***Setting Up the Experiment***

// Meta-var's
// var turk_code = "JSALK23";
// var study_version = "ma_choice_v1_pilot1";

// var study_time = 30;
// var study_money = 3.60;

// var instr_reading_time = 2000; // in milliseconds
// var instructions_time = 0;

// // find the assignmentId & debugging status from the URL
// var urlParams = parseURLParams(window.location.href);
// var assignmentId = '';
// var debug = false;
// if (typeof urlParams != "undefined") {
//     if (urlParams.hasOwnProperty('assignmentId')) {
//         assignmentId = urlParams.assignmentId[0];
//     }

//     if (urlParams.hasOwnProperty('debug')) {
//         debug = urlParams.debug[0];
//     }
// } 


//added attributes to arrays-- other option is to create hashmap/dictionary
var home_attributes=['Number of Bedrooms','Pool','Size of Garage','Amount of Crime in Neighborhood','Proximity to Parks','Proximity to Cafes/Restaurants','Noise Pollution','Closest School Reputation','Amount of Natural Light','Age of Building','Washer/Dryer','Size of Yard','Fireplace','Central AC','Climate','Hardwood Floors','Freshly Painted Exterior','Proximity to Neighboring Houses'];
var yn =['Yes','No'];
var size_of_att = ['None','Small','Medium','Large'];
var crime = ['Very Low', 'Low', 'Moderate', 'High', 'Very High'];
var pollution = ['Low', 'Medium', 'High'];
var prox1 = ['5 min', '10 min', '20 min'];
var prox2 = ['10 min', '30 min', '60 min'];
var light = ['No Natural Light', 'A Little Natural Light', 'Moderate Natural Light', 'A lot of Natural Light'];
var age = ['New','Old'];
var climate = ['Hot','Moderate','Cold'];

function generateTable(){
let n=5;
var num_of_attributes = jsPsych.randomization.sampleWithoutReplacement(home_attributes,n);
//for (let j=0;j<num_of_attributes.length;j++)
//console.log(num_of_attributes[j]);
var arr = [];
	for (let j=0;j<num_of_attributes.length;j++){
 	if(num_of_attributes[j]==='Number of Bedrooms'){
 		arr.push(['Number of Bedrooms',Math.floor(Math.random() * 5) + 1, Math.floor(Math.random() * 5) + 1]);
 	}
 	
	else if(num_of_attributes[j]=='Pool'){
		arr.push(['Pool',yn[Math.floor(Math.random() * yn.length)],yn[Math.floor(Math.random() * yn.length)]]);
	}

	else if(num_of_attributes[j]=='Size of Garage'){
		arr.push(['Size of Garage',size_of_att[Math.floor(Math.random() * size_of_att.length)],size_of_att[Math.floor(Math.random() * size_of_att.length)]]);
	}

	else if(num_of_attributes[j]=='Amount of Crime in Neighborhood'){
		arr.push(['Amount of Crime in Neighborhood',crime[Math.floor(Math.random() * crime.length)],crime[Math.floor(Math.random() * crime.length)]]);
	}

	else if(num_of_attributes[j]=='Proximity to Parks'){
		arr.push(['Proximity to Parks',prox1[Math.floor(Math.random() * prox1.length)],prox1[Math.floor(Math.random() * prox1.length)]]);
	}

	else if(num_of_attributes[j]=='Proximity to Cafes/Restaurants'){
		arr.push(['Proximity to Cafes/Restaurants',prox1[Math.floor(Math.random() * prox1.length)],prox1[Math.floor(Math.random() * prox1.length)]]);
	}

	else if(num_of_attributes[j]=='Noise Pollution'){
		arr.push(['Noise Pollution',pollution[Math.floor(Math.random() * pollution.length)],pollution[Math.floor(Math.random() * pollution.length)]]);
	}

	else if(num_of_attributes[j]=='Closest School Reputation'){
		arr.push(['Closest School Reputation',prox2[Math.floor(Math.random() * prox2.length)],prox2[Math.floor(Math.random() * prox2.length)]]);
	}

	else if(num_of_attributes[j]=='Amount of Natural Light'){
		arr.push(['Amount of Natural Light',light[Math.floor(Math.random() * light.length)],light[Math.floor(Math.random() * light.length)]]);
	}

	else if(num_of_attributes[j]=='Age of Building'){
		arr.push(['Age of Building',age[Math.floor(Math.random() * age.length)],age[Math.floor(Math.random() * age.length)]]);
	}

	else if(num_of_attributes[j]=='Washer/Dryer'){
		arr.push(['Washer/Dryer',yn[Math.floor(Math.random() * yn.length)],yn[Math.floor(Math.random() * yn.length)]]);
	}

	else if(num_of_attributes[j]=='Size of Yard'){
		arr.push(['Size of Yard',size_of_att[Math.floor(Math.random() * size_of_att.length)],size_of_att[Math.floor(Math.random() * size_of_att.length)]]);
	}

	else if(num_of_attributes[j]=='Fireplace'){
		arr.push(['Fireplace',yn[Math.floor(Math.random() * yn.length)],yn[Math.floor(Math.random() * yn.length)]]);
	}

	else if(num_of_attributes[j]=='Central AC'){
		arr.push(['Central AC',yn[Math.floor(Math.random() * yn.length)],yn[Math.floor(Math.random() * yn.length)]]);
	}

	else if(num_of_attributes[j]=='Climate'){
		arr.push(['Climate',climate[Math.floor(Math.random() * climate.length)],climate[Math.floor(Math.random() * climate.length)]]);
	}

	else if(num_of_attributes[j]=='Hardwood Floors'){
		arr.push(['Hardwood Floors',yn[Math.floor(Math.random() * yn.length)],yn[Math.floor(Math.random() * yn.length)]]);
	}

	else if(num_of_attributes[j]=='Freshly Painted Exterior'){
		arr.push(['Freshly Painted Exterior',yn[Math.floor(Math.random() * yn.length)],yn[Math.floor(Math.random() * yn.length)]]);
	}

	else if (num_of_attributes[j]=='Proximity to Neighboring Houses') {
		arr.push(['Proximity to Neighboring Houses',prox1[Math.floor(Math.random() * prox1.length)],prox1[Math.floor(Math.random() * prox1.length)]]);
	}
console.log(arr);

//console.log(num_of_attributes);
//console.log(arr[0][1]);
}


return "<div align='center'><table border = 2px solid black><thead></tr><tr><th></th><td><b>Home A</b></td><td><b>Home B</b></td><tr><th>"+arr[0][0]+"</th><td>"+arr[0][1]+"</td><td>"+arr[0][2]+"</td><tr><th>"+arr[1][0]+"</th><td>"+arr[1][1]+"</td><td>"+arr[1][2]+"</td></tr><tr><th>"+arr[2][0]+"</th><td>"+arr[2][1]+"</td><td>"+arr[2][2]+"</td></tr><tr><th>"+arr[3][0]+"</th><td>"+arr[3][1]+"</td><td>"+arr[3][2]+"</td></tr><tr><th>"+arr[4][0]+"</th><td>"+arr[4][1]+"</td><td>"+arr[4][2]+"</td></tr></table>"    	
}

var start_instructions = 0;

// ***Intro Blocks***

var welcome = {
	type: "html-keyboard-response",
	stimulus: "<div class='center-content'>Welcome to the experiment. Press any key to begin."
};

// var get_id = {
// 	type: 'survey-text',
// 	questions: [{prompt: "<b>Worker ID:</b>", name: "worker_id"}],
// 	preamble: ["Please enter your <b>Amazon Mechanical Turk Worker ID</b> below.<br>(When you're done, press <b>'Continue'</b>; don't hit Enter.)<br><br>If you do not enter your ID accurately, we will not be able to pay you."],
// };

// var get_id_loop = {
// 	timeline: [get_id],
// 	loop_function: function(data) {
// 		id = data.values()[0].response.worker_id;
// 		if (id) {
// 			jsPsych.data.addProperties({
// 				subject: id,
// 				version: study_version,
// 				assignmentId: assignmentId
// 			});

// 			start_instructions = Date.now();

// 			return false;
// 		} else {
// 			alert("Please provide your Amazon Mechanical Turk Worker ID.");
// 			return true;
// 		}
// 	}
// } 

// var check_consent = function(elem) {
// 	if ($('#consent_checkbox').is(':checked')) {
// 		return true;
// 	}
// 	else {
// 		alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
// 		return false;
// 	}
// 	return false;
// };
// var consent_block = {
// 	type:'external-html',
// 	url: "consent.php?time=" + study_time + "&money=" + study_money + "&test=1",
// 	cont_btn: "start",
// 	check_fn: check_consent,
// 	force_refresh: true
// };

// first attention check
var attnCheck1 = {
    type: 'survey-text',
    questions: [{prompt: 'Your response', name: 'attention_check'}],
    preamble: ["Please type this exact sentence into the box below: 'I will complete this study with my full attention.' and then continue."],
    on_finish: function(data) {
    	jsPsych.data.addProperties({attention_check: data.response.attention_check});
    }
};

// ***Welcome and Task 1 Instructions***

var instructions_text = ['Welcome to the study! <br></br>\
	Please <b>do not</b> press the <b>back</b> button or <b>refresh</b> your browser during the study; if you do, you will have to start over. <br><br> Please click <b>Next</b> and read the following instructions carefully. <br></br>',

 	'<br></br>In this experiment, you will make a series of selections between two hotels. Each hotel will have a list of features, and will be presented to you in a table like the one below: <br></br><img src="hotel.jpg" width = "500" height = "400"></img><br></br> Your job is to pick the hotel you would most likely stay at out of the two options presented. <b>After you complete this task, we will ask you to reflect upon how you made your decisions. So while you are selecting hotels, please pay attention to what is playing a role in your selection and your strategy in selecting a hotel.</b> <br></br>',

 	'Please press <b>F</b> to select the hotel on the <b>LEFT</b> and <b>J</b> to select the hotel on the <b>RIGHT</b>. The hotel you select will be highlighted in red to indicate your choice.<br></br> There will be 100 trials in Part 1.<br><br>When you are ready to start, hit <b>Next</b>. <br></br>']

var instructions = {
	type: "instructions",
	pages: instructions_text,
	show_clickable_nav: true
}

var trial = {
	 type: 'html-keyboard-response',
	 stimulus: generateTable,
	 choices: ['F', 'J'],
	 prompt: 'Click <b>F</b> for <b>Home A</b> and <b>J</b> for <b>Home B</b>',
	 //trial_duration: 1000,
	 post_trial_gap: 500
}

var fixation = {
    type: 'html-keyboard-response',
    stimulus: '<span style="font-size:40px;">+</span>',
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000
}

// var countdown_trial = {
//   type: 'html-button-response',
//   stimulus: '<p>The next part of the experiment will start in <span id="clock">1:00</span>.',
//   choices: ['Continue'],
//   on_load: function(){
//     var wait_time = 1 * 10 * 1000; // in milliseconds
//     var start_time = performance.now();
//     document.querySelector('button').disabled = true;
//     var interval = setInterval(function(){
//       var time_left = wait_time - (performance.now() - start_time);
//       var minutes = Math.floor(time_left / 1000 / 60);
//       var seconds = Math.floor((time_left - minutes*1000*60)/1000);
//       var seconds_str = seconds.toString().padStart(2,'0');
//       document.querySelector('#clock').innerHTML = minutes + ':' + seconds_str
//       if(time_left <= 0){
//         document.querySelector('#clock').innerHTML = "0:00";
//         document.querySelector('button').disabled = false;
//         clearInterval(interval);
//       }
//     }, 250)
//   }
// }



var timeline = []

//timeline.push(welcome);
//timeline.push(get_id_loop);
//timeline.push(consent_block);
//timeline.push(attnCheck1);
//timeline.push(instructions);
for (var t = 0; t < 5; t++) {
	timeline.push(fixation);
	//timeline.push(countdown_trial);
	timeline.push(trial);
	
}

jsPsych.init({
	timeline: timeline,
	default_iti: 500,
	minimum_valid_rt: 700,
});

</script>
</html>